record(ai, "VA-SI-Fam:DI-DCCT:NoiseLvl")
{
field(DESC, "Noise level for beam current")
field(INP, 10e-3)
field(EGU, "mA")
}

record(calc, "SI-13C4:DI-DCCT:Current-Mon")
{
    field(DESC, "SI current")
    field(SCAN, ".1 second")
    field(PREC, 10)
    field(INPA, "VA-SI-13C4:DI-DCCT:Current-Mon")
    field(INPB, "VA-SI-Fam:DI-DCCT:NoiseLvl")
    field(CALC, "A + B*(RNDM*2.0 - 1.0)")
    field(EGU, "mA")
    field(FLNK, "SI-14C4:DI-DCCT:Current-Mon")
}

record(calc, "SI-14C4:DI-DCCT:Current-Mon")
{
    field(DESC, "SI current")
    field(SCAN, ".1 second")
    field(PREC, 10)
    field(INPA, "VA-SI-14C4:DI-DCCT:Current-Mon")
    field(INPB, "VA-SI-Fam:DI-DCCT:NoiseLvl")
    field(CALC, "A + B*(RNDM*2.0 - 1.0)")
    field(EGU, "mA")
}

record(aSub, "Add-Noise-SI-Fam:DI-DCCT")
{
    field(SCAN, ".1 second")
    field(SNAM, "add_noise")
    field(INPA, "VA-SI-13C4:DI-DCCT:BbBCurrent-Mon")
    field(INPB, "VA-SI-14C4:DI-DCCT:BbBCurrent-Mon")
    field(INPC, "VA-SI-Fam:DI-DCCT:NoiseLvl")
    field(NOA, 864)
    field(NOB, 864)
    field(NOC, 1)
    field(NOVA, 864)
    field(NOVB, 864)
    field(FLNK, "SI-13C4:DI-DCCT:BbBCurrent-Mon")
}

record(waveform, "SI-13C4:DI-DCCT:BbBCurrent-Mon")
{
    field(DESC, "SI bunch current from DCCT at 13C4")
    field(INP, "Add-Noise-SI-Fam:DI-DCCT.A")
    field(NELM, 864)
    field(FTVL, "DOUBLE")
    field(EGU, "mA")
    field(FLNK, "SI-14C4:DI-DCCT:BbBCurrent-Mon")
}

record(waveform, "SI-14C4:DI-DCCT:BbBCurrent-Mon")
{
    field(DESC, "SI bunch current from DCCT at 14C4")
    field(INP, "Add-Noise-SI-Fam:DI-DCCT.B")
    field(NELM, 864)
    field(FTVL, "DOUBLE")
    field(EGU, "mA")
}
